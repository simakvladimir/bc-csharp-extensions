using System.Text;
using NUnit.Framework;
using Org.BouncyCastle.Cms;
using Org.BouncyCastle.Cms.Tests;
using Org.BouncyCastle.Utilities.Encoders;

namespace Org.BouncyCastle.Extensions.Cms.Tests
{
    [TestFixture]
    public class KncaSignedDataTest
    {
        private static readonly byte[] contentRsa = Encoding.UTF8.GetBytes("test attribute");
        private static readonly byte[] contentGost = Encoding.UTF8.GetBytes("test");

        private static readonly byte[] gostSignature = Base64.Decode("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");
        private static readonly byte[] rsaSignature = Base64.Decode("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");

        [TestFixtureSetUp]
        public void SetUp()
        {
            ExtensionsHandler.Init();
        }

        [Test]
        public void TestRsaVerification()
        {
            var cms = new CmsSignedData(rsaSignature);
            if (cms.SignedContent == null)
            {
                cms = new CmsSignedData(new CmsProcessableByteArray(contentRsa), rsaSignature);
            }
            SignedDataTest.VerifySignatures(cms);
        }

        [Test]
        public void TestGostVerification()
        {
            var cms = new CmsSignedData(gostSignature);
            if (cms.SignedContent == null)
            {
                cms = new CmsSignedData(new CmsProcessableByteArray(contentGost), gostSignature);
            }
            SignedDataTest.VerifySignatures(cms);
        }
    }
}
